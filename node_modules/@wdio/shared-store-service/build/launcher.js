"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _logger = _interopRequireDefault(require("@wdio/logger"));

var _utils = require("./utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const log = (0, _logger.default)('@wdio/shared-store-service');
let server = null;

class SharedStoreLauncher {
  constructor() {
    this.pidFile = (0, _utils.getPidPath)(process.pid);
  }

  async onPrepare() {
    server = require('./server').default;
    const result = await server.startServer();
    log.info(`Started shared server on port ${result.port}`);
    await (0, _utils.writeFile)(this.pidFile, result.port);
  }

  async onComplete() {
    await server.stopServer();
    await (0, _utils.deleteFile)(this.pidFile);
  }

}

exports.default = SharedStoreLauncher;